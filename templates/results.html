<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TALE Finder - Results</title>
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
</head>
<body>
    <h1>TALE Finder - Results</h1>
    <p><a href="/">New Search</a></p>
    <hr>

    {% if error %}
    <p style="color: red;"><strong>Error:</strong> {{ error }}</p>
    {% endif %}

    {% if cached %}
    <p><em>Results loaded from cache (previously computed)</em></p>
    {% endif %}

    <h2>Search Summary</h2>
    <table border="1" cellpadding="5">
        <tr><th>Sequence Length</th><td>{{ sequence_length }} bp</td></tr>
        <tr><th>Search Mode</th><td>{{ search_mode }}</td></tr>
        <tr><th>Orientation</th><td>{{ orientation }}</td></tr>
        <tr><th>TALE Length</th><td>{{ min_tale_length }} - {{ max_tale_length }} bp</td></tr>
        {% if search_mode == 'pairs' %}
        <tr><th>Spacer Length</th><td>{{ min_spacer_length }} - {{ max_spacer_length }} bp</td></tr>
        {% endif %}
        <tr><th>G Code</th><td>{{ g_code }}</td></tr>
        <tr><th>Total Results</th><td>{{ total_results }}</td></tr>
        <tr><th>Search Hash</th><td><code>{{ search_hash }}</code></td></tr>
    </table>

    <h2>Export Results</h2>
    <p>
        <a href="/export/{{ session_id }}?format=csv">Download CSV</a> |
        <a href="/export/{{ session_id }}?format=tsv">Download TSV</a> |
        <a href="/export/{{ session_id }}?format=fasta">Download FASTA</a>
    </p>

    {% if search_mode == 'pairs' %}
    <h2>TALE Pairs Found ({{ total_results }})</h2>

    {% if results %}
    <table border="1" cellpadding="5">
        <thead>
            <tr>
                <th>#</th>
                <th>Left TALE</th>
                <th>Spacer</th>
                <th>Right TALE</th>
                <th>Orientation</th>
                <th>Options</th>
            </tr>
        </thead>
        <tbody>
            {% for pair in results %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>
                    <strong>Position:</strong> {{ pair.left_start }}-{{ pair.left_end }}<br>
                    <strong>Strand:</strong> {{ pair.left_strand }}<br>
                    <strong>RVD:</strong> <code>{{ pair.left_rvd }}</code><br>
                    <strong>DNA:</strong> <code>{{ pair.left_dna }}</code>
                </td>
                <td>{{ pair.spacer_length }} bp</td>
                <td>
                    <strong>Position:</strong> {{ pair.right_start }}-{{ pair.right_end }}<br>
                    <strong>Strand:</strong> {{ pair.right_strand }}<br>
                    <strong>RVD:</strong> <code>{{ pair.right_rvd }}</code><br>
                    <strong>DNA:</strong> <code>{{ pair.right_dna }}</code>
                </td>
                <td>{{ pair.orientation }}</td>
                <td>
                    <form action="/design/{{ session_id }}/{{ pair.id }}" method="GET" style="display:inline;">
                        <button type="submit">Design Plasmid</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No TALE pairs found matching your criteria.</p>
    {% endif %}

    {% else %}
    <h2>Single TALEs Found ({{ total_results }})</h2>

    {% if results %}
    <table border="1" cellpadding="5">
        <thead>
            <tr>
                <th>#</th>
                <th>Position</th>
                <th>Strand</th>
                <th>Length</th>
                <th>RVD Sequence</th>
                <th>DNA Target</th>
                <th>GC%</th>
                <th>Options</th>
            </tr>
        </thead>
        <tbody>
            {% for tale in results %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ tale.start }}-{{ tale.end }}</td>
                <td>{{ tale.strand }}</td>
                <td>{{ tale.length }} bp</td>
                <td><code>{{ tale.rvd }}</code></td>
                <td><code>{{ tale.dna }}</code></td>
                <td>{{ tale.gc_content }}%</td>
                <td>
                    <form action="/design/{{ session_id }}/{{ tale.id }}" method="GET" style="display:inline;">
                        <button type="submit">Design Plasmid</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No TALEs found matching your criteria.</p>
    {% endif %}
    {% endif %}

    {% if page_count > 1 %}
    <h3>Pages</h3>
    <p>
        {% for p in range(1, page_count + 1) %}
        {% if p == page %}
        <strong>{{ p }}</strong>
        {% else %}
        <a href="/results/{{ session_id }}?page={{ p }}">{{ p }}</a>
        {% endif %}
        {% endfor %}
    </p>
    {% endif %}

    <hr>
    <p><a href="/">New Search</a> | <a href="/about">About</a></p>
</body>
</html>
